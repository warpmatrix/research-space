# Skedulix: Hybrid Cloud Scheduling for Cost-Efficient Execution of Serverless Applications

2020 IEEE 13th International Conference on Cloud Computing (CLOUD)

混合云（公有-私有）下 serverless 的优化问题：和私有云相比可以获得更快的速度，和公有云相比获得了更低的成本。两个问题：why and how?

- 公有云的特点：云服务提供商管理云资源方便扩展管理
- 私有云的优势：可以处理敏感数据、无需经过网络的传输处理延时可减少、对于一些长期运行的任务和服务可以获得成本优势
- 私有云的劣势：资源受限可能无法满足 SLA

因此，使用混合云进行 serverless 的调度，可以实现公有云和私有云的 tradeoff，兼具公有云和私有云的优点。问题转换为决定某一任务放置于私有云处理还是公有云处理，整个问题变为混合整型线性规划问题 (MILP)。

- MILP 问题可以放到标准求解器进行求解，e.g. Gurobi
- 但在数据量较大时，求解时间过长

## Problem Formulation

- 一个任务由不同的 stage 组成，不同的 stage 有不同的依赖关系组成一个 DAG
- 私有云上执行任务成本可以近似为 0，公有云上执行任务需要付出相应的成本
- 私有云有一定的存储结果能力，公有云上拥有无限的存储能力但数据存储在公有云需要进行数据转换

由于私有云上的计算成本为 0，因此计算任务应尽可能放置于私有云上处理。若计算能力不足则可以卸载到公有云上进行处理。

## System Design

1. 估计任务执行所需要的时间，将显然超出私有云处理能力的任务卸载到公有云上进行处理
2. 根据一定的选择策略，选择优先程度高的任务在私有云进行计算
3. 计算队列中每个任务的 Apparent Closeness to Deadline (ACD)，估计任务是否可以被执行
   - 如果 ACD 为负将对应的任务卸载到公有云进行计算

不同的选择策略：

- 优先选择在公有云计算成本高的任务在私有云计算，选择在公有云计算成本低的任务进行卸载
  - 有助于降低在公有云计算的总成本
- 优先选择计算时间小的任务在私有云计算，选择计算时间长的任务在公有云进行卸载
  - 有助于提高私有云计算的并行程度，同时减少在公有云中计算的舍入造成的成本

> 注意到高成本可能由长计算时间导致，因此两种选择策略在一定程度上是相反的。因此，一种策略的优点对应另一种策略的缺点

搭建私有云一些组件：OpenFaaS, Minio（存储平台）

系统的一些细节：

- 系统使用 stage 作为调度的粒度：一个任务中可能存在瓶颈 stage，更佳的选择为将瓶颈 stage 置于公有云进行操作，而非将整个任务置于公有云
- 使用私有云计算的延时组成：
  - 函数的计算时间：需要通过机器学习模型通过训练集得到
  - 框架的开销：可以直接通过统计得到框架开销的平均值
- 对于 IO 密集型的应用，函数的计算时延也比较小，因此预估出来的 MAPE 也比较大
  - 使用公有云进行计算可能导致模型预估的时延比较大？
- 使用模型预估计算时延，对于一些延时比较小的阶段得到的 MAPE 比较大
  - 但这些时延往往因为比较小，不会对系统的性能造成太大的影响

## Experiment Result

- SPT 和 HCF 的算法性能相差不多，都能达到节约成本的效果
- 整个系统使用贪心的算法得到的成本开销接近最优解
  - 这在求解 NP-hard 问题中求解最优解可能需要大量的时间
  - 得到相差不多的近似解也是令人满意的。
- SPT 优先卸载执行时间比较长的任务，因此大多数情况下卸载任务的总数较 HCF 少
  - 在计算密集的任务中，所需的成本也更小
  - 但在 IO 密集的任务中，SPT 卸载的任务数量和 HCF 相差无几，得到的成本要高于 HC
- 任务实际的完成时间也接近用户给定的时间，误差和模型估计函数的运行时间相当
  - 因此说明估计函数运行时间的模型的重要性

做实验立靶子的重要性：成本和公有云进行对比，计算时间和私有云进行对比

- 实验做出来的指标和不同方面中拉跨的进行比较，才能凸显出自己框架的牛逼

实验扩展的方向：

- 动态的 deadline violation
- min cost/makespan objective
