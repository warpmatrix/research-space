# 基于无服务器计算的边云协同视频分析技术研究

主要工作方向：

- 边云协同的函数编排系统
  - 区别于基于云的函数编排系统，侧重于云边协同
  - 实现与 ASF（AWS Step Functions）的兼容
- 边云协同的视频分析系统
- 边云协同的划分算法

研究内容分为三个方向：

- 云边协调的视频分析
- 基于 serverless 的视频分析
- 资源管理和计算任务卸载

## 系统组成

系统功能划分：

- 基础架构层：函数编排系统
- 应用层：应用场景下的应用模式
- 调度层：划分系统

边云协同的函数编排系统包含的模块：边缘状态机模块、边云协同模块、云端状态机模块

- 边缘状态机模块：边缘段函数编排系统
  - 状态模块：可用状态集合（DAG 实现应用逻辑的函数集合）
  - 状态机模块：描述状态之间的逻辑关系（构建应用的 ASF）
  - 执行模块：管理状态之间的转移关系
- 边云协同模块：完成边缘函数编排系统与 ASF 的结合
  - 两类函数工厂：Factory、AuxFatory
  - 路由模块、通用数据结构 Msg：边云无障碍通信
  - Lambda 导出模块：云端 ASF 重用边缘代码，实现自动化边云部署
- 云端状态机模块：在 ASF 的基础上拓展功能模块

边云协同视频分析系统

- 系统下函数的逻辑关系存在选择、并行等复杂关系
- 可以对场景下的视频分析任务分解
- 视频分析系统：基础架构层和应用层组成

边云协同的划分算法

- 函数执行过程中涉及多个并行子任务，需要对视频分析任务进行多分割点切分
- 基于进化策略算法：满足时延要求，最小化开销，NP-hard

## 函数编排方法与系统

系统运行背景：

- 边缘设备：去除多余视频帧、关键数据上传
- 视频分析相关流程：视频解码、区域提取、人脸识别、姿态检测、目标分类、风格迁移
- AWS Lambda 的两种调用方式：事件调用、HTTP 调用
- AWS Lambda 的两种部署方式：docker 镜像、zip 文件
- ASF 的相关术语：状态机、状态、Task、Choice、Map
- ASF 的调用方式：同步、异步
- Serverless 应用包含的组件：Lambda Functions、ASF、API Gateway、事件源、资源权限
- SAM 模板文件：全局变量（运行环境、运行时间）、资源属性（权限、类型）

系统功能需求分析：

- 边缘状态机模块：状态池、状态机构建、状态机解释、通用数据传递
- 边云协同模块：网关功能、路由功能（状态机切分）、边云协同能力、自动部署能力
- 晕染状态机模块：数据存储、状态机嵌套、运行时间记录

系统非功能需求：高可用、高性能、安全

## 视频分析系统

功能需求：算法融合、多分割点场景下的边云协同、视频解码、记录

非功能需求：并发（性能）、用户友好、系统可靠性

关键状态：

- router：路由状态，连接所有其他状态
- ExtractTask：记录 Lambda 的执行时间
- PassTask：记录并行执行状态机的执行时间

行人检测视频分析系统：

- 场景实例化
- 状态机涉及图逻辑组织
- 边缘状态机实例化
- 自动部署云端状态机
- 视频分割、云边协同

不同的分割点划分情况：

- 状态之间进行切分：云端与 stateMachine 结合
- 嵌套状态机内切分：云端与 wrappedStateMachine 结合

## 任务调度算法

进化策略预测当前视频分析任务的划分策略

- 基于历史人脸数量预测当前帧人脸数量，确定 DAG 形态
- 将每个函数的执行时间和预测的人脸数量作为输入，输出视频分析任务的划分策略
- 黑盒优化算法，适应不同视频，动态变化 DAG 结构
- 整数线性规划问题，NP-hard

算法包含的三个模块：数据刷新模块、人脸预测模块、进化策略模块

- 对应的功能需求：数据刷新、时许预测、多分割点决策

## 附录

- ASF：AWS Step Functions
- AWS SAM：AWS Serverless Application Model
- ASL：Amazon States Language
- ECR：Elastic Container Register
- ARN：Amazon Resource
